- name: Set node subnet from inventory
  ansible.builtin.set_fact:
    node_subnet: "{{ hostvars[inventory_hostname].pod_cidr }}"
  when: hostvars[inventory_hostname].pod_cidr is defined

- name: Render 10-bridge.conf
  ansible.builtin.template:
    src: 10-bridge.conf.j2
    dest: "/home/{{ ssh_target_user }}/10-bridge.conf"
    owner: root
    group: root
    mode: '0644'

- name: Copy Kubelet configs
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "/home/{{ ssh_target_user }}/"
    owner: root
    group: root
    mode: '0644'
  loop: "{{ configs }}"
  loop_control:
    label: "{{ item }}"

- name: Copy Kubelet services
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "/home/{{ ssh_target_user }}/"
    owner: root
    group: root
    mode: '0644'
  loop: "{{ services }}"
  loop_control:
    label: "{{ item }}"
