- name: Set node subnet from inventory
  ansible.builtin.set_fact:
    node_subnet: "{{ hostvars[inventory_hostname].pod_cidr }}"
  when: hostvars[inventory_hostname].subnet is defined

- name: Render 10-bridge.conf
  ansible.builtin.template:
    src: 10-bridge.conf.j2
    dest: "/home/{{ ssh_target_user }}/10-bridge.conf"
    owner: root
    group: root
    mode: '0644'

- name: Copy kubelet config
  ansible.builtin.copy:
    src: kubelet-config.yaml
    dest: "/home/{{ ssh_target_user }}/kubelet-config.yaml"
    owner: root
    group: root
    mode: '0644'